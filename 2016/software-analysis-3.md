## 数据流分析2

### [北大课件3](http://sei.pku.edu.cn/~xiongyf04/SA/2015/3%20dataflow%20analysis%20II.pdf)

### 数据流分析安全性定义

安全性:对控制流图上任意结点v[i]和所有从entry到v[i]的路径集合P,满足DATAvi ⊑ ⊓  v[1]v[2]v[3]...v[i]∈P  f[v[i]]∘f[v[i-1]]∘⋯∘f[v[1]] (entry)

证明：

 给定任意路径的 v[1]v[2]v[3]...v[i],DATA[vi]的计算相当于在每两个相邻转换函数f[v[i]] ∘ f[v[i-1]] 之间加入了MEET交汇计算,根据幂等性,任意交汇计算的 结果一定在偏序上小于等于原始结果。再根据转换函数的单调性,DATA[v[i]] 的值一定小于等于f[v[i]]∘f[v[i-1]]∘⋯∘f[v[1]] (entry)。由于原路径的任意性,DATA[v[i]] 是一个下界。

而⊓  v[1]v[2]v[3]...v[i]∈P  f[v[i]]∘f[v[i-1]]∘⋯∘f[v[1]] (entry)是各个路径下的最大下界。所以DATAvi ⊑ ⊓  v[1]v[2]v[3]...v[i]∈P  f[v[i]]∘f[v[i-1]]∘⋯∘f[v[1]] (entry)成立

### 数据流分析的分配性

一个数据流分析满足分配性,如果 ∀v∈V,x,y∈S:f[v] (x) ⊓f[v] (y) =f[v] (x⊓y)

当数据流分析满足分配性的要求时，DATAvi = ⊓  v[1]v[2]v[3]...v[i]∈P  f[v[i]]∘f[v[i-1]]∘⋯∘f[v[1]] (entry)，此时方案2(提前合并，见数据流分析1)不是近似

### 数据流分析收敛性

不动点:给定一个函数f: S → S,如果f(x) = x,则称x是f的一个不动点

不动点定理:给定高度有限的半格(S,⊓)和一个单调 函数f,链⊤[s],f(⊤[s]) ,f(f(⊤[s])) ,...必定在有限步之内收敛于f的最大不动点,即存在非负整数n,使得 f[n] (⊤[s]) 是f的最大不动点。

证明:

- 收敛于f的不动点:
  - f(⊤[s]) ⊑ ⊤[s],两边应用f,得f(f(⊤[s])) ⊑ f(⊤[s]) ,
  - 应用f可得f(f(f(⊤[s]))) ⊑ f(f(⊤[s]))
  - 因此，原链是个递减链。因为该格高度有限，所以必然存在某个位置前后元素相等，即，到达不动点。
- 收敛于最大不动点:
    - 假设有另外一不动点u，则𝑢 ⊑ ⊤[𝑠]，两边反复应用f可证

### 数据流分析的收敛性

给定固定的结点选择策略，原算法可以看做是反复应用一个函数
(DATA[v1]，DATA[v2], ... DATA[vn]) := f(DATA[v1], DATA[v2], ... DATA[vn])
根据不动点定理，原算法在有限步内终止，并且收敛于最大不动点。

### Widening

原始转换函数f
新转换函数w∘f
牺牲精确度来保证收敛性

安全性讨论:

- 新转换仍然单调
- 新转换结果小于等于原结果,意味着DATA[v]的结果 小于等于原始结果

### Narrowing

通过再次应用原始转换函数对Widening的结果进 行简单修正

ps: *由于不能保证Narrowing的收敛性,通常应用有限次原始转换函数*


小结:

- 数据流分析的安全性可以通过最大下界的性质来 证明
- 数据流分析的收敛性可以通过不动点定理来分析
- 数据流分析也可以看做是一个方程求解的过程
- 可以通过Widening和Narrowing来处理无限半格 的情况