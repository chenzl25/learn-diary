## 数据流分析1

### [北大课件2](http://sei.pku.edu.cn/~xiongyf04/SA/2015/2%20dataflow%20analysis.pdf)

程序可以看成是状态(数据)和状态之间的转移(控制)两部分,因为状态转移的条件都被忽略了,核心分析的部分是状态数据在转移过程中的变化,所以叫做数据流分析。


### 符号分析

抽象符号:

- 正 ={所有的正数}
- 零={0}
- 负= {所有的负数}
- 槑={所有的整数和NaN}

```c
x*=-100;
y+=1;
while(y < z) {
  x *= -100;
  y += 1;
}
```
输入:x为负,y为零,z为正
输出:x为槑,y为正,z为正

处理思路，考虑所有的可能的路径，计算他们对应结果(用抽象值来表示)，最后合并(*特定的合并函数*)所有路径的结果。

符号分析中，我们可以进行近似：

1. 忽略所有判断条件
2. 不在路径末尾做合并,在控制流汇合的所有位置提前做合并

### 活跃变量分析 (Liveness Analysis)

活跃变量:给定程序中 的某条语句s和变量v, 如果在s执行前保存在v 中的值在后续执行中还 会被读取就被称作活跃 变量

## 数据流分析单调框架

通过配置框架的参数,可以导出各种类型的算法(*如上面符号分析和活跃变量分析类型的算法*),并保证算法的安全性、终止性、收敛性(=终止+合流)

### 半格

半格是一个二元组(S,⊓),其中S是一个集合,⊓ 是一个交汇运算,并且任意x, y, z ∈ S都满足下 列条件:

- 幂等性idempotence: x ⊓ x = x
- 交换性commutativity: x ⊓ y = y ⊓ x
- 结合性associativity: x⊓y ⊓z=x⊓(y⊓z) 
- 存在一个最大元⊤,使得x ⊓ ⊤ = x

### 偏序

偏序是一个二元组(S, ⊑),其中S是一个集合, ⊑ 是一个定义在S上的二元关系,并且满足如下性 质:
- 自反性:∀a∈S:a⊑a
- 传递性:∀x,y,z∈S:x⊑y∧y⊑z⇒x⊑z 
- 非对称性:x⊑y∧y⊑x⇒x=y
- 每个半格都定义了一个偏序关系 
- x⊑y当且仅当x⊓y=x

#### 半格示例

任意集合和交集操作组成了一个半格 :

- 偏序关系为子集关系
- 顶元素为全集

半格的笛卡尔乘积(S × T,⊓xy)还是半格(s1,t1) ⊓xy (s2,t2) = (s1 ⊓x s2,t1 ⊓y t2)

#### 半格高度

半格的偏序图中任意两个结点的最大距离+1

#### 集合的最大下界

半格的任意子集都有最大下界


### 单调函数(*Monotone Function*)

给定一个偏序关系(S, ⊑),称一个定义在S上的
函数f为单调函数,当且仅当对任意a, b ∈ S满足 •a⊑b⇒f(a) ⊑f(b)

示例:

1. 在符号分析的半格中,固定任一输入参数,抽象符号 的四个操作均为单调函数

| +  | 正 | 负 | 零 | 槑 |
|----|----|----|----|----|
| 正 | 正 |    |    |    |
| 负 | 槑 | 负 |    |    |
| 零 | 正 | 负 | 零 |    |
| 槑 | 槑 | 槑 | 槑 | 槑 |

2. 在集合和交/并操作构成的半格中,给定任意两个集 合GEN, KILL,函数f (S)= (S − KILL) ∪ GEN为单调函数

### 数据流分析单调框架

- 一个控制流图(v, E)
- 一个有限高度的半格(S,⊓)
- 一个entry的初值I
- 一组结点转换函数,对任意v ∈ v − entry存在 一个结点转换函数f

```
DATA[entry] = I
∀ v∈(V−entry):DATAv ←⊤V
ToVisit ← V − entry // 可以换成succ(entry)吗? 答：不可以 
While(ToVisit.size > 0) {
  v ← ToVisit中任意结点
  ToVisit -= v
  MEET[v] ←⊓[w∈pred(v)] DATA[w]
  If (DATA[v] ≠ f[v](MEET[v]) ToVisit ∪= succ(v)
  DATA[v] ←f[v](MEET[v]
}
```